# ğŸ“Š Executive Summary - KipuBankV3 Gas Costs

**Version:** 1.0.0
**Date:** 2025-11-09
**Solidity:** 0.8.30 (Optimizer: 200 runs)
**Author**: Hernan Herrera
**Organization**: White Paper

---

## ğŸ’° Main Costs (50 gwei, ETH = $3000)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER OPERATIONS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Function                        â”‚ Gas      â”‚ Cost USD            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¸ depositETH()                 â”‚ 213,000  â”‚ $31.95              â”‚
â”‚ ğŸ’¸ depositToken() [with swap]   â”‚ 250,000  â”‚ $37.50              â”‚
â”‚ ğŸ’¸ depositToken() [USDC]        â”‚  81,500  â”‚ $12.24              â”‚
â”‚ ğŸ’µ withdraw()                   â”‚  58,000  â”‚  $8.70              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MANAGEMENT OPERATIONS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Function                        â”‚ Gas      â”‚ Cost USD            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš™ï¸  addToken()                  â”‚  54,400  â”‚  $8.16              â”‚
â”‚ âš™ï¸  setTokenStatus()            â”‚   8,100  â”‚  $1.22              â”‚
â”‚ âš™ï¸  setBankCap()                â”‚  11,200  â”‚  $1.68              â”‚
â”‚ âš™ï¸  setWithdrawalLimit()        â”‚  11,200  â”‚  $1.68              â”‚
â”‚ âš™ï¸  setSlippageTolerance()      â”‚   8,600  â”‚  $1.29              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN OPERATIONS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Function                        â”‚ Gas      â”‚ Cost USD            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ›‘ pause()                      â”‚  10,200  â”‚  $1.53              â”‚
â”‚ â–¶ï¸  unpause()                   â”‚  10,200  â”‚  $1.53              â”‚
â”‚ ğŸš¨ emergencyWithdraw() [ETH]    â”‚  15,700  â”‚  $2.36              â”‚
â”‚ ğŸš¨ emergencyWithdraw() [Token]  â”‚  35,700  â”‚  $5.36              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIEW FUNCTIONS (FREE)*                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Function                        â”‚ Gas**    â”‚ Cost USD            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘ï¸  getBalance()                â”‚   2,100  â”‚  $0.00 (view)       â”‚
â”‚ ğŸ‘ï¸  getTotalBankValueUSD()      â”‚   2,100  â”‚  $0.00 (view)       â”‚
â”‚ ğŸ‘ï¸  getSupportedTokens()        â”‚   3,100  â”‚  $0.00 (view)       â”‚
â”‚ ğŸ‘ï¸  getTokenInfo()              â”‚   2,600  â”‚  $0.00 (view)       â”‚
â”‚ ğŸ‘ï¸  getETHPriceUSD()            â”‚   6,000  â”‚  $0.00 (view)       â”‚
â”‚ ğŸ‘ï¸  getExpectedUSDC()           â”‚   9,000  â”‚  $0.00 (view)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*View functions are free when called with `eth_call` (not in transactions)
**Estimated gas if called in a transaction

---

## ğŸ“ˆ Comparison by Gas Price Scenario

### ETH Deposit (213,000 gas)

| Gas Price | Cost in ETH | Cost in USD (ETH=$3000) |
|-----------|-------------|-------------------------|
| 20 gwei   | 0.00426 ETH | **$12.78** ğŸŸ¢           |
| 30 gwei   | 0.00639 ETH | **$19.17** ğŸŸ¢           |
| 50 gwei   | 0.01065 ETH | **$31.95** ğŸŸ¡           |
| 100 gwei  | 0.02130 ETH | **$63.90** ğŸ”´           |
| 200 gwei  | 0.04260 ETH | **$127.80** ğŸ”´          |

### USDC Withdrawal (58,000 gas)

| Gas Price | Cost in ETH | Cost in USD (ETH=$3000) |
|-----------|-------------|-------------------------|
| 20 gwei   | 0.00116 ETH | **$3.48** ğŸŸ¢            |
| 30 gwei   | 0.00174 ETH | **$5.22** ğŸŸ¢            |
| 50 gwei   | 0.00290 ETH | **$8.70** ğŸŸ¡            |
| 100 gwei  | 0.00580 ETH | **$17.40** ğŸ”´           |
| 200 gwei  | 0.01160 ETH | **$34.80** ğŸ”´           |

---

## ğŸ¯ Tips to Minimize Costs

### 1. ğŸ’¡ Deposit USDC Directly

```
âŒ depositToken(DAI, 1000) â†’ Swap â†’ 250,000 gas â†’ $37.50
âœ… depositToken(USDC, 1000) â†’ Direct â†’ 81,500 gas â†’ $12.24

ğŸ’° SAVINGS: ~$25.26 (67% less gas)
```

### 2. â° Wait for Low Gas Price

```
Average Gas Price by Hour (UTC):
- 00:00 - 06:00: 20-40 gwei  â† BEST TIME ğŸŒ™
- 06:00 - 12:00: 40-80 gwei
- 12:00 - 18:00: 60-120 gwei â† AVOID â˜€ï¸
- 18:00 - 24:00: 50-90 gwei
```

**Tools:**
- [ETH Gas Station](https://ethgasstation.info/)
- [Gas Now](https://www.gasnow.org/)
- [Blocknative Gas Estimator](https://www.blocknative.com/gas-estimator)

### 3. ğŸ“¦ Batch Operations

```
âŒ 10 deposits of $100 = 10 Ã— 213,000 gas = 2,130,000 gas
âœ… 1 deposit of $1000 = 1 Ã— 213,000 gas = 213,000 gas

ğŸ’° SAVINGS: ~90% in gas costs by using batch
```

### 4. ğŸŒ Use Layer 2 (Future)

When KipuBankV3 is deployed on L2:

| Network | Gas Cost vs L1 | depositETH() Cost |
|---------|----------------|-------------------|
| Ethereum L1 | 1x | $31.95 |
| **Polygon** | **~100x cheaper** | **~$0.32** ğŸ‰ |
| **Arbitrum** | **~10x cheaper** | **~$3.20** ğŸ‰ |
| **Optimism** | **~10x cheaper** | **~$3.20** ğŸ‰ |
| **zkSync** | **~50x cheaper** | **~$0.64** ğŸ‰ |

---

## ğŸ“Š Cost Distribution in depositETH()

```
Total: 213,000 gas ($31.95)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Uniswap Swap: 160,000 gas (75%)        â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚  Storage Writes: 32,100 gas (15%)       â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚  Storage Reads: 10,500 gas (5%)         â”‚ â–ˆâ–ˆ
â”‚  Validations: 7,400 gas (3%)            â”‚ â–ˆ
â”‚  Events: 3,000 gas (2%)                 â”‚ â–ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Conclusion:** 75% of the cost is the Uniswap V2 swap (unavoidable).

---

## âœ… Applied Optimizations

### Before vs After Optimizations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Function           â”‚ Before (gas)â”‚ After (gas)  â”‚ Savings  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ depositETH()       â”‚ 230,000     â”‚ 213,000      â”‚ -7.4%    â”‚
â”‚ depositToken()     â”‚ 265,000     â”‚ 250,000      â”‚ -5.7%    â”‚
â”‚ withdraw()         â”‚  75,000     â”‚  58,000      â”‚ -22.7%   â”‚
â”‚ setBankCap()       â”‚  13,300     â”‚  11,200      â”‚ -15.8%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“‰ Average savings: 12-15%
ğŸ’° Savings in USD: ~$3-6 per transaction
```

### Techniques Applied:

âœ… **State Variable Caching** - Single storage read
âœ… **Single SSTORE per Variable** - Single write
âœ… **Unchecked Arithmetic** - Where mathematically safe
âœ… **Memory Structs** - Instead of storage pointers
âœ… **No Emit Immutables** - Don't cache constant values

---

## ğŸš€ Real World Use Case

### Average User (10 operations/month)

```
Operations:
- 5 ETH deposits       â†’ 5 Ã— $31.95 = $159.75
- 3 USDC deposits      â†’ 3 Ã— $12.24 = $36.72
- 2 withdrawals        â†’ 2 Ã— $8.70  = $17.40
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MONTHLY TOTAL:                      $213.87

At low gas (30 gwei):               $128.32 ğŸ’° 40% savings
On L2 (Polygon):                      $2.14 ğŸ’° 99% savings
```

### Power User (50 operations/month)

```
Operations:
- 25 ETH deposits      â†’ 25 Ã— $31.95 = $798.75
- 15 USDC deposits     â†’ 15 Ã— $12.24 = $183.60
- 10 withdrawals       â†’ 10 Ã— $8.70  = $87.00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MONTHLY TOTAL:                    $1,069.35

At low gas (30 gwei):              $641.61 ğŸ’° 40% savings
On L2 (Polygon):                     $10.69 ğŸ’° 99% savings
```

---

## ğŸ“– How to Read This Report

### Symbols

- ğŸ’¸ = Deposit operations
- ğŸ’µ = Withdrawal operations
- âš™ï¸ = Configuration operations
- ğŸ›‘ = Pause operations
- ğŸš¨ = Emergency operations
- ğŸ‘ï¸ = Query functions (view)
- ğŸŸ¢ = Low cost (< $20)
- ğŸŸ¡ = Medium cost ($20-$50)
- ğŸ”´ = High cost (> $50)

### Terms

- **Gas:** Unit of computation in Ethereum
- **gwei:** 1 gwei = 0.000000001 ETH (10^-9)
- **SLOAD:** Storage read operation (~2,100 gas)
- **SSTORE:** Storage write operation (~5,000-22,100 gas)
- **View function:** Read-only function (free outside tx)

---

## ğŸ”— Resources

- **Monitor Gas in Real Time:**
  - https://etherscan.io/gastracker
  - https://ultrasound.money/#gas

- **Run Local Analysis:**
  ```bash
  forge test --gas-report
  ./test-gas.sh
  ```

- **Complete Documentation:**
  - [GAS_ANALYSIS.md](GAS_ANALYSIS.md) - Detailed analysis

---

## ğŸ“ Final Notes

1. **Costs are estimates** - May vary Â±5-10% depending on network state
2. **View functions ARE FREE** when used for queries (not in tx)
3. **Uniswap swap dominates cost** - ~75% of gas in swap deposits
4. **Depositing USDC saves 67%** vs depositing other tokens
5. **Gas price varies greatly** - Monitor before large operations

---

**ğŸ’¡ Final Tip:** For large operations (>$1000), wait for gas < 30 gwei. Savings can be > $20 per transaction.

---

**Version:** 1.0.0
**Last Updated:** 2025-11-09
**Generated by:** KipuBankV3 Gas Analyzer
